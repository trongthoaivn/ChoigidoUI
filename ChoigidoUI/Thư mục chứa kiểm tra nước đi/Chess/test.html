<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <title>Document</title>
    <style>
        .board_game td {
            width: 70px;
            max-width: 70px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div style="border: 1px solid black;" id="col2">
        <table class="board_game" width="560"></table>
    </div>
</body>

</html>

<script>
    $(document).ready(function() {
        const col = ["1", "2", "3", "4", "5", "6", "7", "8"];
        const row = ["1", "2", "3", "4", "5", "6", "7", "8"];
        var color = ["#C36E38", "#F8DDB5"];
        var pos = 0;
        //cột
        for (i = 0; i < 8; i++) {
            $(".board_game").append('<tr class="' + col[i] + ' " height="70" ></tr>');
            if (i % 2 == 0) {
                pos = 0;
            } else {
                pos = 1;
            }
            //hàng
            for (j = 0; j < 8; j++) {
                if (pos == 0) {
                    pos += 1;
                } else {
                    pos -= 1;
                }
                $("." + col[i] + "").append('<td id= "' + col[i] + row[j] + '" style="background-color:' + color[pos] + ';"></td>');
                // drop(col[i] + row[j]);
            }
            // $("#H" + (i + 1)).append('<img class="' + i + ' black" width="70px" src="https://redive.estertion.win/card/full/102561.webp"></div>')
            // drag("colume");
        }
        //trắng
        $("#1" + (1)).append('<img class="xe ' + 1 + ' white" width="30px" src="/Chess/xe-trang.png"></div>');
        $("#1" + (2)).append('<img class="ngua ' + 2 + ' white" width="30px" src="/Chess/ngua-trang.png"></div>');
        $("#1" + (3)).append('<img class="tuong ' + 3 + ' white" width="30px" src="/Chess/tuong-trang.png"></div>');
        $("#1" + (4)).append('<img class="vua ' + 4 + ' white" width="30px" src="/Chess/vua-trang.png"></div>');
        $("#1" + (5)).append('<img class="hau ' + 5 + ' white" width="30px" src="/Chess/hau-trang.png"></div>');
        $("#1" + (6)).append('<img class="tuong ' + 6 + ' white" width="30px" src="/Chess/tuong-trang.png"></div>');
        $("#1" + (7)).append('<img class="ngua ' + 7 + ' white" width="30px" src="/Chess/ngua-trang.png"></div>');
        $("#1" + (8)).append('<img class="xe ' + 8 + ' white" width="30px" src="/Chess/xe-trang.png"></div>');
        //đen
        $("#8" + (1)).append('<img class="xe ' + 1 + ' black" width="30px" src="/Chess/xe-den.png"></div>');
        $("#8" + (2)).append('<img class="ngua ' + 2 + ' black" width="30px" src="/Chess/ngua-den.png"></div>');
        $("#8" + (3)).append('<img class="tuong ' + 3 + ' black" width="30px" src="/Chess/tuong-den.png"></div>');
        $("#8" + (4)).append('<img class="vua ' + 4 + ' black" width="30px" src="/Chess/vua-den.png"></div>');
        $("#8" + (5)).append('<img class="hau ' + 5 + ' black" width="30px" src="/Chess/hau-den.png"></div>');
        $("#8" + (6)).append('<img class="tuong ' + 6 + ' black" width="30px" src="/Chess/tuong-den.png"></div>');
        $("#8" + (7)).append('<img class="ngua ' + 7 + ' black" width="30px" src="/Chess/ngua-den.png"></div>');
        $("#8" + (8)).append('<img class="xe ' + 8 + ' black" width="30px" src="/Chess/xe-den.png"></div>');
        for (a = 0; a < 9; a++) {
            $("#2" + (a)).append('<img class="tot ' + a + ' white" width="30px" src="/Chess/tot-trang.png"></div>')
        }
        for (a = 0; a < 9; a++) {
            $("#7" + (a)).append('<img class="tot ' + a + ' black" width="30px" src="/Chess/tot-den.png"></div>')
        }
        $('img').draggable({
            containment: ".board_game",
            revert: 'invalid'
        });
        var newPoss = 0;
        var oldPoss = 0;
        $('td').droppable({
            over: function(el, ui) {
                oldPoss = ui.draggable.parent().attr("id")
                console.log(ui.draggable.parent().attr("id"))
                newPoss = $(this).attr("id")
                console.log($(this).attr("id"))
                if (Number($(this).attr("id")) == Number(ui.draggable.parent().attr("id")) + 10 || Number($(this).attr("id")) == Number(ui.draggable.parent().attr("id")) + 20) {
                    console.log("lớn hơn")
                    $(this).css({
                        "border": "5px solid white"
                    })
                } else {
                    $(this).css({
                        "border": "5px solid red"
                    })
                }
                ui.draggable.parent().droppable("enable");
            },
            out: function(el, ui) {
                $(this).css({
                    "border": "none"
                })
            },
            accept: function(el, ui) {
                var flag = false;

                // console.log("Accept" + newPoss + " old Poss" + oldPoss)
                // if (Number(newPoss) == Number(oldPoss) + 10 || Number(newPoss) == Number(oldPoss) + 20) {
                //     console.log("here")
                //     flag = true;
                // } else {
                //     flag = false;
                // }

                var className = $(this).find("img").attr("class");
                var name = el.attr("class").split(" ");
                if (className != undefined) {
                    var split = className.split(" ");
                    if (split[2] == name[2]) {
                        flag = false;
                    } else {
                        flag = true;
                    }
                } else {
                    flag = true;

                }
                return flag;
            },
            drop: function(ev, ui) {
                console.log("Stop: " + newPoss + "---" + oldPoss)
                var dropped = ui.draggable;
                var droppedOn = $(this);
                var name = ui.draggable.attr("class").split(" ");
                console.log("Tên quân cờ: " + name[0])
                console.log("Phe " + name[2])
                console.log("Vị trí cũ " + $(dropped).parent().attr("id"));
                switch (name[0]) {
                    case 'tot':
                        if (Number(newPoss) == Number(oldPoss) + 10 || Number(newPoss) == Number(oldPoss) + 20) {
                            $(this).css({
                                "border": "none"
                            })
                            if ($('td').not('td:empty')) {
                                var className = $(droppedOn).find("img").attr("class");
                                if (className != undefined) {
                                    var split = className.split(" ");
                                    if (split[2] != name[2]) {
                                        console.log("Khác phe cờ");
                                        $(droppedOn).find('img').remove()
                                    } else {
                                        $(droppedOn).droppable("disable");
                                    }
                                }
                            }
                            $(dropped).parent().droppable("enable");
                            $(dropped).detach().css({
                                top: 0,
                                left: 0
                            }).appendTo(droppedOn);
                            console.log("Vị trí mới " + $(dropped).parent().attr("id"))
                            console.log("--------------------------------------------")
                        } else {
                            $(this).css({
                                "border": "none"
                            })
                            $(dropped).detach().css({
                                top: 0,
                                left: 0
                            }).appendTo("#" + oldPoss + "");
                        }
                        break;
                    default:
                        $(this).css({
                            "border": "none"
                        })
                        $(dropped).detach().css({
                            top: 0,
                            left: 0
                        }).appendTo("#" + oldPoss + "");
                        break;
                }
            }
        });
        $('td').not('td:empty').droppable("disable");
    });
</script>

<!-- <script>
    // function drag(id) {
    //     $("." + id + "").draggable({
    //         revert: "invalid",
    //         containment: $('.board_game'),
    //         stop: function() {
    //             var offset = $(this).offset();
    //             var xPos = offset.left;
    //             var yPos = offset.top;
    //             console.log("Vị trí theo số: " + xPos + "-" + yPos);
    //             console.log("--------------------------------------------");
    //         }
    //     });
    // }

    // function drop(id) {
    //     $("#" + id + "").droppable({
    //         // over: function(event, ui) {

    //         // },
    //         // revert: function() {
    //         //     if ($(this).length) {
    //         //         console.log("yes")
    //         //     }
    //         // },
    //         // accept: function(el) {
    //         //     if ($(".colume").length) {
    //         //         console.log("true")
    //         //     }
    //         // },
    //         // accept: ".colume",
    //         drop: function(event, ui) {
    //             if ($("#" + id + " .colume").length == 0) {
    //                 ui.draggable.detach().appendTo($(this));
    //             }
    //             // $(this).droppable('disable');
    //             if ($(this).length) {
    //                 // $(this).droppable('enable');
    //                 console.log("--------------------------------------------");
    //                 console.log("Quân cờ đang kéo: " + ui.draggable.attr("id"));
    //                 console.log("Vị trí thả: " + $(this).attr("id"));
    //                 // $(this).droppable('enable');
    //             }
    //         }

    //     });
    // }
</script> -->